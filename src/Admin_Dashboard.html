<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoGauge - AQI Dashboard</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-start: #0b1020;
            --bg-end: #0e1430;
            --card: #111833;
            --header-bg: rgba(22, 27, 34, .7);
            --border-color: rgba(255, 255, 255, .1);
            --muted: #97a3b6;
            --text: #e8ecf6;

            --accent1: #29B6F6;
            --accent2: #81D4FA;
            --logo-color: #29B6F6;
            --glow-color-rgba: rgba(41, 182, 246, 0.4);

            --good: #22c55e;
            --moderate: #facc15;
            --poor: #f97316;
            --unhealthy: #ef4444;
            --severe: #a855f7;
            --hazardous: #800000;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: linear-gradient(120deg, var(--bg-start) 0%, var(--bg-end) 100%);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .site-nav {
            background-color: var(--header-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 24px;
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(8px);
        }

        .nav-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            width: 100%;
            gap: 1rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--logo-color);
            text-decoration: none;
            transition: filter 0.2s ease;
        }
        .logo:hover { filter: brightness(1.2); }

        .nav-controls {
            grid-column: 2 / 3;
            justify-self: center;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        #menu-btn {
            background: none;
            border: none;
            color: var(--text);
            font-size: 28px;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }
        #menu-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .toggle-btn-group {
            display: inline-flex;
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid var(--accent1);
            box-shadow: 0 0 8px 2px var(--glow-color-rgba);
        }

        .toggle-btn {
            padding: 6px 16px; font-weight: 500; transition: all 0.2s ease-in-out;
            background-color: transparent; color: var(--accent2);
            border: none; cursor: pointer; display: inline-flex;
            align-items: center; gap: 0.5rem;
        }
        .toggle-btn:not(:last-child) { border-right: 1px solid var(--accent1); }
        .toggle-btn.active { background-color: var(--accent1); color: #FFFFFF; }
        .toggle-btn:hover:not(.active) { background-color: rgba(41, 182, 246, 0.2); color: white; }

        .search-form {
            position: relative;
            min-width: 250px;
        }
        .search-form input {
          border-radius: 20px;
          padding-left: 15px;
          padding-right: 45px;
          background-color: rgba(255, 255, 255, .05);
          border: 1px solid rgba(255, 255, 255, 0.5);
          color: var(--text);
          transition: all 0.2s ease-in-out;
          height: 38px;
          width: 100%;
        }
        .search-form input:focus {
            border-color: var(--accent1);
            background-color: var(--card);
            outline: none;
            box-shadow: none;
        }
        .search-form input::placeholder {
            color: var(--muted);
        }
        .search-form button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background-color: var(--accent1);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .search-form button:hover {
            background-color: #0091ea;
        }

        /* Side Menu */
        .side-menu-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .side-menu-backdrop.active {
            opacity: 1;
            pointer-events: auto;
        }
        .side-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100%;
            background-color: var(--bg-end);
            border-right: 1px solid var(--border-color);
            z-index: 101;
            transition: left 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .side-menu.active {
            left: 0;
        }
        .side-menu-header {
            padding: 1rem 1rem 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            height: 65px; /* Match navbar height */
        }
        #close-menu-btn {
            background: none;
            border: none;
            color: var(--muted);
            font-size: 24px;
            cursor: pointer;
        }
        .side-menu-nav {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .menu-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            color: var(--muted);
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
        }
        .menu-item i {
            font-size: 1.25rem;
        }
        .menu-item:hover {
            background-color: rgba(255,255,255,0.05);
            color: var(--text);
        }
        .menu-item.active {
            background-color: var(--accent1);
            color: white;
            box-shadow: 0 0 15px var(--glow-color-rgba);
        }

        main { padding: 24px; flex-grow: 1; }

        .card {
            background: radial-gradient(1200px 420px at -20% -20%, rgba(111, 86, 250, .1), transparent 60%),
                        radial-gradient(800px 300px at 120% 140%, rgba(79, 156, 255, .08), transparent 55%),
                        linear-gradient(180deg, rgba(255, 255, 255, .05), rgba(255, 255, 255, .02));
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 18px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, .25);
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        }
        .card:hover { transform: translateY(-3px); }

        .btn {
            cursor: pointer;
            padding: 8px 14px;
            border-radius: 20px;
            background: transparent;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            font-weight: 500;
            white-space: nowrap;
        }
        .btn.primary {
            border: 1px solid var(--accent1);
            color: var(--accent1);
        }
        .btn.primary:hover {
            background-color: rgba(41, 182, 246, 0.15);
            color: white;
            box-shadow: 0 0 15px 5px var(--glow-color-rgba);
        }

        .btn.danger {
            border: 1px solid var(--unhealthy);
            color: var(--unhealthy);
        }
        .btn.danger:hover {
            background-color: rgba(239, 68, 68, 0.15);
            color: white;
            box-shadow: 0 0 15px 5px rgba(239, 68, 68, 0.4);
        }

        .btn.warning {
            border: 1px solid var(--poor);
            color: var(--poor);
        }
        .btn.warning:hover {
            background-color: rgba(251, 146, 60, 0.15);
            color: white;
            box-shadow: 0 0 15px 5px rgba(251, 146, 60, 0.4);
        }

        .btn.secondary {
           background: rgba(255,255,255,0.05);
           border: 1px solid var(--border-color);
           color: var(--text);
        }
        .btn.secondary:hover {
            background-color: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.2);
        }

        .btn i { font-size: 1.2em; }
        .btn.hidden { display: none; }

        .filter-btn-group { display: inline-flex; border-radius: 20px; overflow: hidden; border: 1px solid var(--border-color); }
        .filter-btn { padding: 6px 16px; font-size: 14px; background: transparent; color: var(--muted); border: none; cursor: pointer; transition: all .2s ease; }
        .filter-btn:not(:last-child) { border-right: 1px solid var(--border-color); }
        .filter-btn.active { background: var(--accent1); color: white; }
        .filter-btn:hover:not(.active) { background: rgba(255,255,255,.05); }

        table {
            width: 100%; border-collapse: collapse; background: rgba(255, 255, 255, .03);
            border: 1px solid var(--border-color); border-radius: 14px; overflow: hidden;
        }
        thead th { font-size: 12px; text-align: left; color: #b7c3d6; background: rgba(255, 255, 255, .04); }
        th, td { padding: 12px 10px; border-bottom: 1px solid rgba(255, 255, 255, .06); font-size: 13px; }
        tbody tr:hover { background: rgba(255, 255, 255, .03); }

        input, select {
            background: rgba(255, 255, 255, .05); border: 1px solid var(--border-color);
            border-radius: 8px; padding: 10px; color: var(--text);
            outline: none; transition: border-color 0.2s; width: 100%;
        }
        input:focus, select:focus { border-color: var(--accent1); }

        .modal-backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6);
            display: flex; justify-content: center; align-items: center; z-index: 1000;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease; backdrop-filter: blur(5px);
        }
        .modal-backdrop.active { opacity: 1; pointer-events: auto; }
        .modal-content { transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-backdrop.active .modal-content { transform: scale(1); }

        .site-footer {
            background-color: var(--header-bg); text-align: center;
            padding: 20px; margin-top: auto; border-top: 1px solid var(--border-color);
        }
        .site-footer p { color: var(--muted); margin: 0; }
        .site-footer a { color: var(--accent1); text-decoration: none; margin: 0 8px; transition: color 0.2s ease; }
        .site-footer a:hover { color: var(--accent2); text-decoration: underline; }

        .value-increase { animation: value-flash-bad 1s ease-out; }
        .value-decrease { animation: value-flash-good 1s ease-out; }
        @keyframes value-flash-good { 0%, 100% { color: inherit; } 50% { color: var(--good); } }
        @keyframes value-flash-bad { 0%, 100% { color: inherit; } 50% { color: var(--unhealthy); } }
        
        @media (max-width: 768px) {
            .nav-controls {
                gap: 0.5rem;
            }
            .search-form {
                display: none;
            }
        }
    </style>
</head>
<body>

<div id="side-menu-backdrop" class="side-menu-backdrop"></div>
<div id="side-menu" class="side-menu">
    <div class="side-menu-header">
        <a class="logo" href="#">EcoGauge</a>
        <button id="close-menu-btn"><i class='bx bx-x'></i></button>
    </div>
    <nav class="side-menu-nav">
        <a href="#" class="menu-item" data-view="dashboard-view">
            <i class='bx bxs-dashboard'></i><span>Dashboard</span>
        </a>
        <a href="#" class="menu-item" data-view="stations-view">
            <i class='bx bxs-edit-location'></i><span>Stations</span>
        </a>
         <a href="#" class="menu-item" data-view="maps-view">
            <i class='bx bxs-map'></i><span>Maps</span>
        </a>
         <a href="#" class="menu-item" data-view="rankings-view">
            <i class='bx bxs-bar-chart-alt-2'></i><span>Rankings</span>
        </a>
        <a href="#" class="menu-item" data-view="feedback-view">
            <i class='bx bxs-message-dots'></i><span>Feedback</span>
        </a>
    </nav>
</div>

<nav class="site-nav">
    <div class="nav-container">
        <div style="display: flex; align-items: center; gap: 1rem; justify-self: start;">
            <button id="menu-btn"><i class='bx bx-menu'></i></button>
            <a class="logo" href="#">EcoGauge</a>
        </div>

        <div class="nav-controls">
            <div class="toggle-btn-group">
                <button class="toggle-btn active"><i class='bx bx-wind'></i><span>AQI</span></button>
                <button class="toggle-btn"><i class='bx bxs-volume-full'></i><span>Noise</span></button>
            </div>
            <form class="search-form" id="searchForm">
                <input type="search" placeholder="Search Stations..." id="citySearch">
                <button type="submit"><i class='bx bx-search-alt-2'></i></button>
            </form>
        </div>
        
        <div style="justify-self: end;"></div>
    </div>
</nav>

<main>
    <div id="notification-container" class="fixed top-20 right-6 z-[1001] flex flex-col-reverse space-y-3 space-y-reverse"></div>

    <div id="dashboard-view">
        <header class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
            <div>
                <h1 class="text-3xl font-extrabold text-white">Mumbai, MH Dashboard</h1>
                <p class="text-slate-400 mt-1">Last updated: <span id="last-updated"></span></p>
            </div>
            <button id="force-refresh-btn" class="btn secondary" title="Force Refresh">
                <i class='bx bx-refresh'></i>
            </button>
        </header>

        <div class="card p-6 rounded-2xl mb-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                <div class="flex items-center gap-2">
                    <h3 id="analysis-title" class="text-xl font-bold text-white">Top 5 Highest AQI Stations</h3>
                </div>
                <div id="analysis-filters" class="flex flex-wrap gap-4 mt-4 md:mt-0">
                    <div class="filter-btn-group" data-filter-group="sort">
                        <button class="filter-btn" data-value="high"><i class='bx bx-sort-up'></i> High</button>
                        <button class="filter-btn" data-value="low"><i class='bx bx-sort-down'></i> Low</button>
                    </div>
                    <div class="filter-btn-group" data-filter-group="line">
                        <button class="filter-btn active" data-value="all">All</button>
                        <button class="filter-btn" data-value="Western">Western</button>
                        <button class="filter-btn" data-value="Central">Central</button>
                        <button class="filter-btn" data-value="Harbour">Harbour</button>
                    </div>
                    <div class="filter-btn-group" data-filter-group="period">
                        <button class="filter-btn active" data-value="live">Live</button>
                        <button class="filter-btn" data-value="weekly">Weekly</button>
                        <button class="filter-btn" data-value="monthly">Monthly</button>
                    </div>
                </div>
            </div>
            <div id="analysis-table-container"></div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="card p-6 flex flex-col justify-center items-center">
                <h3 class="text-lg font-semibold text-slate-400">City-Wide Average AQI</h3>
                <div class="relative w-full h-40">
                    <canvas id="aqiGaugeChart"></canvas>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span id="overall-aqi-value" class="text-5xl font-extrabold">--</span>
                        <span id="overall-aqi-status" class="text-lg font-semibold mt-1">--</span>
                    </div>
                </div>
            </div>
            <div class="card p-6">
                <div class="flex items-center mb-4">
                    <i class='bx bxs-error text-2xl text-red-500 mr-3'></i>
                    <h3 class="text-xl font-bold text-white">Active Alerts</h3>
                </div>
                <div class="flex flex-wrap gap-2 mb-4">
                    <div id="alert-line-filter" class="filter-btn-group" data-filter-group="alert-line">
                        <button class="filter-btn active" data-value="all">All</button>
                        <button class="filter-btn" data-value="Western">Western</button>
                        <button class="filter-btn" data-value="Central">Central</button>
                        <button class="filter-btn" data-value="Harbour">Harbour</button>
                    </div>
                </div>
                <div class="overflow-x-auto max-h-64">
                    <table class="w-full text-sm text-left">
                        <thead>
                        <tr>
                            <th>Location</th>
                            <th>AQI</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody id="alerts-dashboard-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="stations-view" class="hidden">
        <h2 class="text-3xl font-extrabold text-white mb-6">Manage Monitoring Stations</h2>
        <div class="card rounded-2xl p-4">
            <div class="flex flex-wrap justify-between items-center gap-4 p-2">
                <div class="flex-grow flex flex-col sm:flex-row gap-4">
                    <div id="station-line-filter" class="filter-btn-group" data-filter-group="station-line">
                        <button class="filter-btn active" data-value="all">All</button>
                        <button class="filter-btn" data-value="Western">Western</button>
                        <button class="filter-btn" data-value="Central">Central</button>
                        <button class="filter-btn" data-value="Harbour">Harbour</button>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button id="delete-selected-btn" class="btn danger hidden"><i class='bx bx-trash'></i></button>
                    <button id="update-selected-btn" class="btn warning hidden"><i class='bx bx-pencil'></i> Update</button>
                    <button id="add-station-table-btn" class="btn primary"><i class='bx bx-plus'></i> Add Station</button>
                </div>
            </div>
            <div class="overflow-y-auto overflow-x-auto mt-4">
                <table class="w-full text-sm text-left">
                    <thead class="sticky top-0 bg-opacity-50 backdrop-blur-sm" style="background-color: var(--card);">
                    <tr>
                        <th class="px-4 py-3 text-center"><input type="checkbox" id="select-all-checkbox"></th>
                        <th>Location</th>
                        <th class="text-center">AQI</th>
                        <th>Status</th>
                        <th class="text-center">Actions</th>
                    </tr>
                    </thead>
                    <tbody id="location-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="maps-view" class="hidden">
        <div class="card p-8 rounded-2xl text-center">
            <i class='bx bxs-map text-6xl text-accent1 mb-4'></i>
            <h2 class="text-2xl font-bold text-white mb-4">Maps View</h2>
            <p class="text-slate-400">This feature is coming soon!</p>
        </div>
    </div>
    
    <div id="rankings-view" class="hidden">
         <div class="card p-8 rounded-2xl text-center">
            <i class='bx bxs-bar-chart-alt-2 text-6xl text-accent1 mb-4'></i>
            <h2 class="text-2xl font-bold text-white mb-4">Rankings View</h2>
            <p class="text-slate-400">This feature is coming soon!</p>
        </div>
    </div>

    <div id="feedback-view" class="hidden">
        <div class="card p-8 rounded-2xl">
            <h2 class="text-2xl font-bold text-white mb-4">Feedback</h2>
            <p class="text-slate-400 mb-6">Let us know what you think!</p>
            <div id="feedback-list" class="space-y-4"></div>
        </div>
    </div>
</main>
<footer class="site-footer">
    <p>&copy; 2025 EcoGauge. All Rights Reserved.</p>
</footer>

<div id="station-modal" class="modal-backdrop">
    <div class="modal-content w-full max-w-md">
        <form id="station-form" class="card p-8 rounded-2xl">
            <h2 id="modal-title" class="text-2xl font-bold mb-6 text-white"></h2>
            <input type="hidden" id="station-id">
            <div class="space-y-4">
                <input type="text" id="station-name" placeholder="Station Name" required>
                <input type="number" step="any" id="station-lat" placeholder="Latitude" required>
                <input type="number" step="any" id="station-lon" placeholder="Longitude" required>
                <select id="station-line" required>
                    <option value="Western">Western</option>
                    <option value="Central">Central</option>
                    <option value="Harbour">Harbour</option>
                </select>
            </div>
            <div class="flex justify-end space-x-4 mt-8">
                <button type="button" class="btn secondary cancel-btn">Cancel</button>
                <button type="submit" class="btn primary">Save</button>
            </div>
        </form>
    </div>
</div>
<div id="delete-modal" class="modal-backdrop">
    <div class="modal-content w-full max-w-sm">
        <div class="card p-8 rounded-2xl text-center">
            <i class='bx bxs-error-circle text-5xl text-red-500 mx-auto'></i>
            <h2 class="text-xl font-bold my-4 text-white">Are you sure?</h2>
            <p id="delete-modal-text" class="text-slate-400 mb-6"></p>
            <div class="flex justify-center space-x-4">
                <button type="button" class="btn secondary cancel-btn">Cancel</button>
                <button type="button" id="confirm-delete-btn" class="btn danger">Delete</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // --- App State & Configuration ---
        const APP = {
            locations: [], history: {}, charts: {},
            updateInterval: 60000, stationsToDelete: [], selectedStations: new Set(),
            analysisFilters: { sort: 'high', line: 'all', period: 'live' },
            stationTableFilters: { search: '', line: 'all' },
            alertFilters: { line: 'all' },
        };
        let simulatorStations = [];

        // --- Integrated Simulation Logic ---
        const STATIONS_DATA = {
          "Western": [
            { name: "Churchgate", coords: [18.9283, 72.8297], base: [38, 78, 30, 40] }, { name: "Marine Lines", coords: [18.9353, 72.8275], base: [37, 76, 29, 41] }, { name: "Charni Road", coords: [18.9436, 72.8211], base: [36, 75, 28, 42] }, { name: "Mumbai Central", coords: [18.9690, 72.8195], base: [42, 82, 33, 38] }, { name: "Mahalaxmi", coords: [18.9811, 72.8250], base: [41, 80, 31, 39] }, { name: "Prabhadevi", coords: [19.0125, 72.8386], base: [44, 83, 34, 36] }, { name: "Dadar (W)", coords: [19.0186, 72.8432], base: [46, 85, 35, 35] }, { name: "Bandra", coords: [19.0567, 72.8411], base: [40, 80, 32, 40] }, { name: "Vile Parle", coords: [19.0995, 72.8437], base: [41, 81, 33, 38] }, { name: "Andheri", coords: [19.1197, 72.8464], base: [43, 84, 34, 37] }, { name: "Jogeshwari", coords: [19.1350, 72.8492], base: [45, 85, 36, 36] }, { name: "Borivali", coords: [19.2290, 72.8574], base: [35, 72, 27, 43] }, { name: "Vasai Road", coords: [19.3819, 72.8383], base: [32, 68, 25, 45] }, { name: "Virar", coords: [19.4583, 72.8042], base: [30, 65, 24, 47] },
          ], "Central": [
            { name: "CSMT", coords: [18.9402, 72.8355], base: [44, 84, 35, 38] }, { name: "Byculla", coords: [18.9750, 72.8335], base: [45, 86, 36, 37] }, { name: "Dadar (C)", coords: [19.0180, 72.8450], base: [48, 90, 38, 34] }, { name: "Matunga", coords: [19.0275, 72.8550], base: [47, 88, 37, 35] }, { name: "Sion", coords: [19.0430, 72.8630], base: [43, 83, 34, 39] }, { name: "Kurla", coords: [19.0640, 72.8850], base: [50, 95, 40, 33] }, { name: "Ghatkopar", coords: [19.0845, 72.9090], base: [46, 88, 37, 35] }, { name: "Bhandup", coords: [19.1430, 72.9360], base: [42, 80, 33, 40] }, { name: "Mulund", coords: [19.1720, 72.9420], base: [40, 79, 32, 41] }, { name: "Thane", coords: [19.1860, 72.9760], base: [43, 85, 34, 39] }, { name: "Diva", coords: [19.1890, 73.0430], base: [49, 92, 39, 34] }, { name: "Dombivli", coords: [19.2183, 73.0869], base: [46, 88, 37, 36] }, { name: "Kalyan", coords: [19.2430, 73.1360], base: [52, 98, 41, 32] }, { name: "Titwala", coords: [19.2930, 73.2050], base: [38, 78, 30, 42] }, { name: "Asangaon", coords: [19.4350, 73.2950], base: [34, 72, 28, 44] },
          ], "Harbour": [
            { name: "Masjid", coords: [18.9480, 72.8370], base: [42, 81, 34, 39] }, { name: "Sandhurst Road", coords: [18.9550, 72.8400], base: [41, 80, 33, 40] }, { name: "Dockyard Road", coords: [18.9610, 72.8440], base: [43, 84, 35, 38] }, { name: "Wadala Road", coords: [19.0180, 72.8680], base: [45, 86, 36, 37] }, { name: "Chuna Bhatti", coords: [19.0450, 72.8800], base: [47, 89, 38, 35] }, { name: "Govandi", coords: [19.0480, 72.9200], base: [54, 100, 42, 31] }, { name: "Vashi", coords: [19.0680, 72.9950], base: [40, 80, 32, 41] }, { name: "Sanpada", coords: [19.0650, 73.0100], base: [39, 78, 31, 42] }, { name: "Juinagar", coords: [19.0550, 73.0200], base: [38, 77, 30, 43] }, { name: "Nerul", coords: [19.0300, 73.0200], base: [37, 75, 29, 44] }, { name: "Belapur CBD", coords: [19.0180, 73.0380], base: [39, 78, 31, 42] }, { name: "Kharghar", coords: [19.0400, 73.0650], base: [38, 76, 30, 43] }, { name: "Panvel", coords: [18.9894, 73.1175], base: [42, 82, 34, 39] },
          ]
        };
        const AQI_BREAKPOINTS = { 'PM2.5': [0, 30, 60, 90, 120, 250, 500], 'PM10': [0, 50, 100, 250, 350, 430, 1000], 'NO2': [0, 40, 80, 180, 280, 400, 1000], 'O3': [0, 50, 100, 168, 208, 748, 2000], 'AQI': [0, 50, 100, 150, 200, 300, 500] };
        function getSubIndex(pollutant, concentration) { const bps = AQI_BREAKPOINTS[pollutant]; const aqiBps = AQI_BREAKPOINTS['AQI']; if (concentration > bps[bps.length - 1]) return aqiBps[aqiBps.length - 1]; let i = 0; while (concentration > bps[i]) { i++; } if (i === 0) return 0; const I_HI = aqiBps[i]; const I_LO = aqiBps[i-1]; const BP_HI = bps[i]; const BP_LO = bps[i-1]; return Math.round(((I_HI - I_LO) / (BP_HI - BP_LO)) * (concentration - BP_LO) + I_LO); }
        function calculateAQI(c) { const si = {'PM2.5': getSubIndex('PM2.5', c['PM2.5']), 'PM10': getSubIndex('PM10', c['PM10']), 'NO2': getSubIndex('NO2', c['NO2']), 'O3': getSubIndex('O3', c['O3'])}; const aqi = Math.max(si['PM2.5'], si['PM10'], si['NO2'], si['O3']); const dom = Object.keys(si).reduce((a, b) => si[a] > si[b] ? a : b); return { aqi, dominant: dom }; }
        function clamp(x, lo, hi) { return Math.max(lo, Math.min(hi, x)); }
        function randNorm(mu = 0, sigma = 1) { let u = 0, v = 0; while (u === 0) u = Math.random(); while (v === 0) v = Math.random(); return mu + sigma * Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2 * Math.PI * v); }
        function getBoosts(d) { const h = d.getHours() + d.getMinutes() / 60; const morningRush = 1.4 * Math.exp(-0.5 * Math.pow((h - 8.5) / 1.5, 2)); const eveningRush = 1.3 * Math.exp(-0.5 * Math.pow((h - 19) / 1.8, 2)); const traffic = morningRush + eveningRush; const inversion = (h < 6 || h > 22) ? 1.2 : 0; const ozonePhoto = 1.5 * Math.exp(-0.5 * Math.pow((h - 14) / 2.5, 2)); return { traffic, inversion, ozonePhoto }; }
        class Station { constructor(id, name, line, lat, lon, bases) { this.id = id; this.name = name; this.line = line; this.lat = lat; this.lon = lon; this.bases = bases; this.state = {'PM2.5': randNorm(), 'PM10': randNorm(), 'NO2': randNorm(), 'O3': randNorm()}; } }
        function simulateBatch(stations, now) { const boosts = getBoosts(now); const rows = []; for (const st of stations) { const concentrations = {}; for (const p in st.bases) { st.state[p] = clamp(st.state[p] + randNorm(0, 0.1), -10, 10); let boost = 1.0; if (p !== 'O3') { boost += boosts.traffic * 0.3 + boosts.inversion * 0.15; } else { boost += boosts.ozonePhoto * 0.4; } let value = (st.bases[p] * boost) + st.state[p] + randNorm(0, 0.2); concentrations[p] = Math.max(0, +value.toFixed(1)); } const { aqi, dominant } = calculateAQI(concentrations); const info = getAqiInfo(aqi); rows.push({ id: st.id, name: st.name, lat: st.lat, lon: st.lon, line: st.line, aqi: aqi, status: info.status, color: info.color, concentrations: concentrations }); } return rows; }
        const DUMMY_FEEDBACK_DATA = [ { name: "Rahul Sharma", email: "rahul.sharma@example.com", region: "Western", location: "Borivali", feedback: "The real-time data is very accurate and helpful. The UI is clean and easy to navigate." }, { name: "Priya Singh", email: "priya.singh@example.com", region: "Harbour", location: "Chembur", feedback: "I've noticed some inconsistencies in the alert notifications. The app is a bit slow to update." }, { name: "Amit Patel", email: "amit.patel@example.com", region: "Central", location: "Thane", feedback: "Great tool for monitoring air quality. The historical data charts are particularly useful for my work." }, { name: "Neha Gupta", email: "neha.gupta@example.com", region: "Western", location: "Andheri", feedback: "The new dashboard layout is fantastic. Could you add a feature to set custom AQI thresholds for alerts?" }, { name: "Vikram Kumar", email: "vikram.kumar@example.com", region: "Harbour", location: "Govandi", feedback: "The app is not working correctly on my device. It crashes frequently. The data is often outdated." }, { name: "Anjali Rao", email: "anjali.rao@example.com", region: "Central", location: "Parel", feedback: "The air quality index seems to be a bit off compared to other sources. Could you explain the data sources?" }, ];
        const getAqiInfo = (aqi) => { if (aqi <= 50) return { status: "Good", color: "#22c55e" }; if (aqi <= 100) return { status: "Moderate", color: "#facc15" }; if (aqi <= 150) return { status: "Poor", color: "#f97316" }; if (aqi <= 200) return { status: "Unhealthy", color: "#ef4444" }; if (aqi <= 300) return { status: "Severe", color: "#a855f7" }; return { status: "Hazardous", color: "#800000" }; };
        function showAqiNotification(message, aqi) { const info = getAqiInfo(aqi); const container = document.getElementById('notification-container'); if (!container) return; const notification = document.createElement('div'); notification.className = `p-4 rounded-lg shadow-lg flex items-center gap-4 transition-transform transform translate-x-full duration-300 ease-out bg-slate-800 border border-slate-700`; notification.innerHTML = `<div class="flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center font-bold text-white" style="background-color: ${info.color};">${aqi}</div><div><p class="font-semibold text-white">${message}</p><p class="text-sm text-slate-400">Status: ${info.status}</p></div><button class="text-slate-500 hover:text-slate-300 ml-auto" onclick="this.closest('div').remove();"><i class="bx bx-x-circle text-lg"></i></button>`; container.prepend(notification); setTimeout(() => notification.classList.remove('translate-x-full'), 10); setTimeout(() => notification.classList.add('translate-x-full'), 5000); setTimeout(() => notification.remove(), 5300); }

        function loadData() {
            let loadedLocations = JSON.parse(localStorage.getItem('aqiLocations'));
            if (!loadedLocations || loadedLocations.length === 0) { const initialSimStations = []; let idCounter = 1; Object.entries(STATIONS_DATA).forEach(([line, stationList]) => { stationList.forEach(s => { const bases = {'PM2.5': s.base[0], 'PM10': s.base[1], 'NO2': s.base[2], 'O3': s.base[3]}; initialSimStations.push(new Station(idCounter, s.name, line, s.coords[0], s.coords[1], bases)); idCounter++; }); }); APP.locations = simulateBatch(initialSimStations, new Date()); } else { APP.locations = loadedLocations; }
            simulatorStations = APP.locations.map(loc => { const bases = loc.concentrations || {'PM2.5': 50, 'PM10': 90, 'NO2': 35, 'O3': 40}; return new Station(loc.id, loc.name, loc.line, loc.lat, loc.lon, bases); });
            APP.history = JSON.parse(localStorage.getItem('aqiHistory')) || {};
        }
        function saveData() { localStorage.setItem('aqiLocations', JSON.stringify(APP.locations)); localStorage.setItem('aqiHistory', JSON.stringify(APP.history)); }
        function recordHistory() { const timestamp = new Date().toISOString(); APP.locations.forEach(loc => { if (!APP.history[loc.id]) APP.history[loc.id] = []; APP.history[loc.id].push({ time: timestamp, aqi: loc.aqi }); if (APP.history[loc.id].length > 1000) APP.history[loc.id].shift(); }); }

        function renderTable() { const tableBody = document.getElementById('location-table-body'); if (!tableBody) return; tableBody.innerHTML = ''; const { search, line } = APP.stationTableFilters; const filteredLocations = APP.locations.filter(loc => loc.name.toLowerCase().includes(search.toLowerCase()) && (line === 'all' || loc.line === line)); filteredLocations.forEach(loc => { const info = getAqiInfo(loc.aqi); const row = document.createElement('tr'); row.className = 'border-b'; row.style.borderColor = 'var(--border-color)'; const isSelected = APP.selectedStations.has(loc.id); row.innerHTML = `<td class="px-4 py-4 text-center"><input type="checkbox" data-id="${loc.id}" class="row-checkbox"></td><td class="px-6 py-4 font-semibold text-white">${loc.name} <span class="text-xs text-slate-400">${loc.line}</span></td><td class="px-6 py-4 text-center font-bold" style="color: ${info.color}">${loc.aqi}</td><td class="px-6 py-4"><span class="px-3 py-1 rounded-full text-xs font-semibold" style="background-color:${info.color}20; color:${info.color};">${info.status}</span></td><td class="px-6 py-4 text-center"><button class="edit-btn p-1 text-blue-400 hover:text-blue-300" data-id="${loc.id}"><i class='bx bx-pencil text-lg'></i></button></td>`; tableBody.appendChild(row); }); updateTableActionButtonsState(); }
        function renderDashboardAlertsTable() { const tableBody = document.getElementById('alerts-dashboard-table-body'); if (!tableBody) return; tableBody.innerHTML = ''; const { line } = APP.alertFilters; const filteredAlerts = APP.locations.filter(loc => (line === 'all' || loc.line === line) && loc.aqi > 130).sort((a, b) => b.aqi - a.aqi); if (filteredAlerts.length === 0) { tableBody.innerHTML = `<tr><td colspan="3" class="text-center text-slate-400 py-4">No places in this region have an AQI above 130.</td></tr>`; return; } filteredAlerts.forEach(loc => { const info = getAqiInfo(loc.aqi); tableBody.innerHTML += `<tr class="border-b" style="border-color: var(--border-color);"><td class="px-6 py-4 font-semibold text-white">${loc.name} <span class="text-xs text-slate-400">${loc.line}</span></td><td class="px-6 py-4 font-bold" style="color:${info.color};">${loc.aqi}</td><td class="px-6 py-4"><span class="px-3 py-1 rounded-full text-xs font-semibold" style="background-color:${info.color}20; color:${info.color};">${info.status}</span></td></tr>`; }); }
        function renderTop5Analysis() {
            const container = document.getElementById('analysis-table-container');
            if (!container) return;
            const { sort, line, period } = APP.analysisFilters;
        
            let filteredLocations = line === 'all' ? [...APP.locations] : APP.locations.filter(loc => loc.line === line);
            let tableHeader = 'AQI';
            let sortedLocations;
        
            if (period === 'live') {
                tableHeader = 'Current AQI';
                sortedLocations = filteredLocations.sort((a, b) => sort === 'high' ? b.aqi - a.aqi : a.aqi - b.aqi);
            } else { // weekly or monthly
                tableHeader = 'Avg AQI';
                const days = period === 'weekly' ? 7 : 30;
                const getAverage = id => {
                    const cutoff = new Date(new Date().setDate(new Date().getDate() - days));
                    const relevantHistory = (APP.history[id] || []).filter(h => new Date(h.time) > cutoff);
                    return relevantHistory.length > 0 ? Math.round(relevantHistory.reduce((acc, h) => acc + h.aqi, 0) / relevantHistory.length) : 0;
                };
                filteredLocations.forEach(loc => loc.avg = getAverage(loc.id));
                sortedLocations = filteredLocations.filter(l => l.avg > 0).sort((a, b) => sort === 'high' ? b.avg - a.avg : a.avg - b.avg);
            }
            
            const top5 = sortedLocations.slice(0, 5);
        
            let rows = top5.map(d => {
                const value = (period === 'live') ? d.aqi : d.avg;
                const info = getAqiInfo(value);
                return `<tr>
                            <td class="py-2 px-4">${d.name}</td>
                            <td class="py-2 px-4 text-center">${d.line}</td>
                            <td class="py-2 px-4 text-right font-semibold" style="color: ${info.color};">${value}</td>
                        </tr>`;
            }).join('');
        
            if (rows.length === 0) {
                rows = `<tr><td colspan="3" class="text-center text-slate-400 py-4">
                    ${period === 'live' ? 'No station data available.' : 'Not enough historical data for this filter.'}
                </td></tr>`;
            }
        
            container.innerHTML = `<table class="w-full text-sm"><thead><tr class="border-b" style="border-color: var(--border-color);"><th class="text-left font-semibold py-2 px-4">Station</th><th class="text-center font-semibold py-2 px-4">Line</th><th class="text-right font-semibold py-2 px-4">${tableHeader}</th></tr></thead><tbody>${rows}</tbody></table>`;
        }
        function renderGaugeChart() { const ctx = document.getElementById('aqiGaugeChart'); if (!ctx) return; if (APP.charts.gauge) APP.charts.gauge.destroy(); const avgAqi = APP.locations.length > 0 ? Math.round(APP.locations.reduce((sum, loc) => sum + loc.aqi, 0) / APP.locations.length) : 0; const info = getAqiInfo(avgAqi); document.getElementById('overall-aqi-value').textContent = avgAqi; document.getElementById('overall-aqi-status').textContent = info.status; document.getElementById('overall-aqi-status').style.color = info.color; APP.charts.gauge = new Chart(ctx.getContext('2d'), { type: 'doughnut', data: { datasets: [{ data: [Math.min(avgAqi, 301), 301 - Math.min(avgAqi, 301)], backgroundColor: [info.color, '#334155'], borderWidth: 0, }] }, options: { rotation: -90, circumference: 180, cutout: '80%', plugins: { tooltip: { enabled: false } }, responsive: true, maintainAspectRatio: false } }); }
        function renderFeedback() { const feedbackList = document.getElementById('feedback-list'); if (!feedbackList) return; feedbackList.innerHTML = ''; if (DUMMY_FEEDBACK_DATA.length === 0) { feedbackList.innerHTML = `<div class="text-center text-sm text-slate-500 py-4">No feedback submitted yet.</div>`; return; } DUMMY_FEEDBACK_DATA.forEach(feedback => { const feedbackItem = document.createElement('div'); feedbackItem.className = 'p-4 rounded-lg'; feedbackItem.style.backgroundColor = 'rgba(255,255,255,0.05)'; feedbackItem.innerHTML = `<div class="flex justify-between items-center mb-2"><p class="font-semibold text-white">${feedback.name} <span class="text-xs text-slate-400">(${feedback.email})</span></p><p class="text-sm text-slate-400">${feedback.region} - ${feedback.location}</p></div><p class="text-slate-200">${feedback.feedback}</p>`; feedbackList.appendChild(feedbackItem); }); }

        function simulateDataUpdate() { const newSimData = simulateBatch(simulatorStations, new Date()); newSimData.forEach(simStation => { const targetLocation = APP.locations.find(loc => loc.id === simStation.id); if (targetLocation) { const oldAqi = targetLocation.aqi; targetLocation.aqi = simStation.aqi; targetLocation.status = simStation.status; targetLocation.color = simStation.color; targetLocation.concentrations = simStation.concentrations; targetLocation.change = simStation.aqi - oldAqi; if (oldAqi <= 130 && simStation.aqi > 130) { showAqiNotification(`⚠️ AQI Alert: ${targetLocation.name} is now ${targetLocation.aqi}`, targetLocation.aqi); } } }); recordHistory(); saveData(); updateUI(); }
        function updateUI() { 
            const lastUpdatedEl = document.getElementById('last-updated'); 
            if (lastUpdatedEl) lastUpdatedEl.textContent = new Date().toLocaleTimeString(); 
            
            // Always render all dynamic data components to ensure consistency across tabs
            renderTable(); // For stations-view
            renderDashboardAlertsTable(); // For dashboard-view
            renderGaugeChart(); // For dashboard-view
            renderTop5Analysis(); // For dashboard-view
        }
        function switchView(viewId) { 
            document.querySelectorAll('[id$="-view"]').forEach(view => view.classList.toggle('hidden', view.id !== viewId)); 
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active')); 
            const activeMenuItem = document.querySelector(`.menu-item[data-view="${viewId}"]`); 
            if (activeMenuItem) activeMenuItem.classList.add('active'); 
            
            updateUI(); 
            
            // Render static components only when their view is activated
            if (viewId === 'feedback-view') {
                renderFeedback();
            }
        }

        const stationModal = document.getElementById('station-modal');
        const deleteModal = document.getElementById('delete-modal');
        const stationForm = document.getElementById('station-form');
        function openStationModal(station = null) { stationForm.reset(); if (station) { document.getElementById('modal-title').textContent = 'Edit Station'; document.getElementById('station-id').value = station.id; document.getElementById('station-name').value = station.name; document.getElementById('station-lat').value = station.lat; document.getElementById('station-lon').value = station.lon; document.getElementById('station-line').value = station.line; } else { document.getElementById('modal-title').textContent = 'Add New Station'; document.getElementById('station-id').value = ''; } stationModal.classList.add('active'); }
        function openDeleteModal() { APP.stationsToDelete = [...APP.selectedStations]; if (APP.stationsToDelete.length === 0) return; const text = `Do you want to delete ${APP.stationsToDelete.length} station(s)? This cannot be undone.`; document.getElementById('delete-modal-text').textContent = text; deleteModal.classList.add('active'); }
        function updateTableActionButtonsState() { const deleteBtn = document.getElementById('delete-selected-btn'); const updateBtn = document.getElementById('update-selected-btn'); if (!deleteBtn || !updateBtn) return; const count = APP.selectedStations.size; deleteBtn.classList.toggle('hidden', count === 0); if (count > 0) deleteBtn.innerHTML = `<i class='bx bx-trash'></i> Delete (${count})`; updateBtn.classList.toggle('hidden', count !== 1); }

        function setupEventListeners() {
            const sideMenu = document.getElementById('side-menu');
            const sideMenuBackdrop = document.getElementById('side-menu-backdrop');
            const openMenuBtn = document.getElementById('menu-btn');
            const closeMenuBtn = document.getElementById('close-menu-btn');
            
            function toggleMenu(active) {
                sideMenu.classList.toggle('active', active);
                sideMenuBackdrop.classList.toggle('active', active);
            }
            
            openMenuBtn.addEventListener('click', () => toggleMenu(true));
            closeMenuBtn.addEventListener('click', () => toggleMenu(false));
            sideMenuBackdrop.addEventListener('click', () => toggleMenu(false));

            document.querySelectorAll('.menu-item').forEach(item => { 
                item.addEventListener('click', (e) => { 
                    e.preventDefault(); 
                    switchView(e.currentTarget.dataset.view); 
                    toggleMenu(false);
                }); 
            });

            document.getElementById('force-refresh-btn')?.addEventListener('click', () => { simulateDataUpdate(); });
            document.getElementById('add-station-table-btn')?.addEventListener('click', () => openStationModal());
            document.querySelectorAll('.cancel-btn').forEach(btn => btn.addEventListener('click', () => { stationModal.classList.remove('active'); deleteModal.classList.remove('active'); }));
            document.getElementById('delete-selected-btn')?.addEventListener('click', openDeleteModal);
            document.getElementById('update-selected-btn')?.addEventListener('click', () => { if (APP.selectedStations.size !== 1) return; const stationId = APP.selectedStations.values().next().value; openStationModal(APP.locations.find(s => s.id === stationId)); });
            stationForm.addEventListener('submit', (e) => { e.preventDefault(); const id = document.getElementById('station-id').value; const stationData = { name: document.getElementById('station-name').value, lat: parseFloat(document.getElementById('station-lat').value), lon: parseFloat(document.getElementById('station-lon').value), line: document.getElementById('station-line').value }; if (id) { const index = APP.locations.findIndex(s => s.id == id); APP.locations[index] = { ...APP.locations[index], ...stationData }; const simIndex = simulatorStations.findIndex(s => s.id == id); if (simIndex > -1) { simulatorStations[simIndex].name = stationData.name; simulatorStations[simIndex].lat = stationData.lat; simulatorStations[simIndex].lon = stationData.lon; simulatorStations[simIndex].line = stationData.line; } } else { stationData.id = Date.now(); stationData.aqi = Math.floor(Math.random() * 100) + 20; const info = getAqiInfo(stationData.aqi); stationData.status = info.status; stationData.color = info.color; APP.locations.push(stationData); const bases = {'PM2.5': 50, 'PM10': 90, 'NO2': 35, 'O3': 40}; simulatorStations.push(new Station(stationData.id, stationData.name, stationData.line, stationData.lat, stationData.lon, bases)); } saveData(); updateUI(); stationModal.classList.remove('active'); });
            document.getElementById('confirm-delete-btn').addEventListener('click', () => { APP.locations = APP.locations.filter(s => !APP.stationsToDelete.includes(s.id)); simulatorStations = simulatorStations.filter(s => !APP.stationsToDelete.includes(s.id)); APP.stationsToDelete.forEach(id => { delete APP.history[id]; }); APP.selectedStations.clear(); const selectAllCheckbox = document.getElementById('select-all-checkbox'); if (selectAllCheckbox) selectAllCheckbox.checked = false; saveData(); updateUI(); deleteModal.classList.remove('active'); });
            document.getElementById('location-table-body')?.addEventListener('click', (e) => { const editBtn = e.target.closest('.edit-btn'); if (editBtn) { openStationModal(APP.locations.find(s => s.id === parseInt(editBtn.dataset.id))); return; } const checkbox = e.target.closest('.row-checkbox'); if (checkbox) { const id = parseInt(checkbox.dataset.id); if (checkbox.checked) APP.selectedStations.add(id); else APP.selectedStations.delete(id); updateTableActionButtonsState(); } });
            document.getElementById('select-all-checkbox')?.addEventListener('change', (e) => { const visibleIds = Array.from(document.getElementById('location-table-body').querySelectorAll('.row-checkbox')).map(cb => parseInt(cb.dataset.id)); visibleIds.forEach(id => { if (e.target.checked) APP.selectedStations.add(id); else APP.selectedStations.delete(id); }); renderTable(); });

            document.getElementById('analysis-filters')?.addEventListener('click', e => {
                const btn = e.target.closest('.filter-btn');
                if (!btn) return;
                const groupEl = btn.parentElement;
                const group = groupEl.dataset.filterGroup;
                const value = btn.dataset.value;
                APP.analysisFilters[group] = value;
                groupEl.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                if (group === 'sort') {
                    const title = document.getElementById('analysis-title');
                    title.textContent = value === 'high' ? 'Top 5 Highest AQI Stations' : 'Top 5 Lowest AQI Stations';
                }
                renderTop5Analysis();
            });

            document.querySelectorAll('[data-filter-group="station-line"], [data-filter-group="alert-line"]').forEach(groupEl => {
                groupEl.addEventListener('click', e => {
                    const btn = e.target.closest('.filter-btn');
                    if (!btn) return;
                    const group = groupEl.dataset.filterGroup, value = btn.dataset.value;
                    const filterKey = group.startsWith('station') ? 'stationTableFilters' : 'alertFilters';
                    APP[filterKey].line = value;
                    groupEl.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    updateUI();
                });
            });

            document.getElementById('citySearch')?.addEventListener('input', (e) => { 
                APP.stationTableFilters.search = e.target.value; 
                // If user is on dashboard, switch to stations view to see search results
                const currentView = document.querySelector('[id$="-view"]:not(.hidden)');
                if (currentView.id === 'dashboard-view') {
                    switchView('stations-view');
                } else {
                    renderTable();
                }
            });
            document.getElementById('searchForm')?.addEventListener('submit', (e) => e.preventDefault());
        }

        function init() {
            loadData();
            setupEventListeners();
            switchView('dashboard-view');
            simulateDataUpdate();
        }

        init();
        setInterval(simulateDataUpdate, APP.updateInterval);
    });
</script>
</body>
</html>

